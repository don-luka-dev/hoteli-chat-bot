@if (visible()) {
<div class="fixed inset-0 bg-black bg-opacity-50 z-40" (click)="close()"></div>
}

<div
  class="fixed top-0 right-0 h-full w-full sm:w-[26rem] bg-white shadow-lg z-50 flex flex-col p-4 transition-transform duration-300"
  [class.translate-x-full]="!visible()" [class.translate-x-0]="visible()" (click)="$event.stopPropagation()">
  <!-- Close -->
  <button pButton icon="pi pi-times" severity="secondary" text class="self-end" (click)="close()"></button>

  <!-- Header -->
  <h2 class="text-xl font-bold mb-1">{{ title() }}</h2>
  <p class="text-sm text-gray-700 mb-4">{{ description() }}</p>

  <!-- Messages -->
  <div class="flex-1 overflow-y-auto space-y-2 pr-1 flex flex-col">
    @for (msg of messages(); track msg) {
    <div class="px-3 py-2 rounded-lg max-w-[80%]" [class.bg-blue-100]="msg.author === 'user'"
      [class.bg-gray-200]="msg.author === 'ai'" [class.self-end]="msg.author === 'user'"
      [class.self-start]="msg.author === 'ai'">
      <div class="text-sm">
        <span class="font-bold">
          {{ msg.author === 'user' ? 'ðŸ§‘ You' : 'ðŸ¤– AI' }}
        </span>
        <div class="mt-1 whitespace-pre-wrap break-words" [innerText]="msg.content"></div>

        @if (msg.imageUrl) {
        <img [src]="msg.imageUrl!" alt="attachment" class="mt-2 max-h-40 rounded border" />
        }
      </div>
    </div>
    }
  </div>

  <!-- Attachment toolbar -->
  <div class="mt-2 flex items-center gap-2">
    <!-- hidden file input -->
    <input id="chat-image-input" type="file" class="hidden" accept="image/*" (change)="onFileSelected($event)" />
    <!-- pick image button -->
    <button pButton icon="pi pi-image" class="p-button-rounded p-button-text" (click)="triggerFileInput()"></button>

    @if (filePreviewUrl()) {
    <div class="flex items-center gap-2 bg-gray-100 px-2 py-1 rounded">
      <span class="text-xs text-gray-700">slika odabrana</span>
      <img [src]="filePreviewUrl()!" alt="preview" class="h-8 w-8 object-cover rounded border" />
      <button pButton icon="pi pi-times" class="p-button-text p-button-sm" (click)="clearAttachment()"></button>
    </div>
    }
  </div>

  <!-- Input + send -->
  <div class="mt-3 flex gap-2">
    <input pInputText type="text" [value]="currentInput()" (input)="currentInput.set($any($event.target).value)"
      placeholder="Type a message..." class="flex-1" (keydown.enter)="sendMessage()" />

    <button pButton icon="pi pi-send" [disabled]="!currentInput().trim() && !selectedFile()" (click)="sendMessage()"
      [severity]="'info'"></button>
  </div>
</div>